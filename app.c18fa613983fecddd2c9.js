/*! For license information please see app.c18fa613983fecddd2c9.js.LICENSE.txt */
!function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t,e){switch(!0){case 0===t:return"top-left";case t<e-1:return"top";case t===e-1:return"top-right";case t===Math.pow(e,2)-1:return"bottom-right";case(t+1)%e==0:return"right";case t>Math.pow(e,2)-e:return"bottom";case t===Math.pow(e,2)-e:return"bottom-left";case t%e==0:return"left";default:return"center"}}function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var s=function(){function t(){r(this,t),this.boardSize=8,this.container=null,this.popup=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}return a(t,[{key:"bindToDOM",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}},{key:"bindPopup",value:function(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.popup=t}},{key:"drawUi",value:function(t){var e=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.popupCloseButton=this.popup.querySelector(".popup__button"),this.newGameEl.addEventListener("click",(function(t){return e.onNewGameClick(t)})),this.saveGameEl.addEventListener("click",(function(t){return e.onSaveGameClick(t)})),this.loadGameEl.addEventListener("click",(function(t){return e.onLoadGameClick(t)})),this.popupCloseButton.addEventListener("click",(function(){return e.closePopup()})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(var r=0;r<Math.pow(this.boardSize,2);r+=1){var n=document.createElement("div");n.classList.add("cell","map-tile","map-tile-".concat(i(r,this.boardSize))),n.addEventListener("mouseenter",(function(t){return e.onCellEnter(t)})),n.addEventListener("mouseleave",(function(t){return e.onCellLeave(t)})),n.addEventListener("click",(function(t){return e.onCellClick(t)})),this.boardEl.appendChild(n)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(t){var e,r=o(this.cells);try{for(r.s();!(e=r.n()).done;)e.value.innerHTML=""}catch(t){r.e(t)}finally{r.f()}var n,a,i=o(t);try{for(i.s();!(n=i.n()).done;){var c=n.value,s=this.boardEl.children[c.position],l=document.createElement("div");l.classList.add("character",c.character.type);var u=document.createElement("div");u.classList.add("health-level");var h=document.createElement("div");h.classList.add("health-level-indicator","health-level-indicator-".concat((a=c.character.health)<15?"critical":a<50?"normal":"high")),h.style.width="".concat(c.character.health,"%"),u.appendChild(h),l.appendChild(u),s.appendChild(l)}}catch(t){i.e(t)}finally{i.f()}}},{key:"addCellEnterListener",value:function(t){this.cellEnterListeners.push(t)}},{key:"addCellLeaveListener",value:function(t){this.cellLeaveListeners.push(t)}},{key:"addCellClickListener",value:function(t){this.cellClickListeners.push(t)}},{key:"addNewGameListener",value:function(t){this.newGameListeners.push(t)}},{key:"addSaveGameListener",value:function(t){this.saveGameListeners.push(t)}},{key:"addLoadGameListener",value:function(t){this.loadGameListeners.push(t)}},{key:"onCellEnter",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellLeave",value:function(t){t.preventDefault();var e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onCellClick",value:function(t){var e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((function(t){return t.call(null,e)}))}},{key:"onNewGameClick",value:function(t){t.preventDefault(),this.newGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onSaveGameClick",value:function(t){t.preventDefault(),this.saveGameListeners.forEach((function(t){return t.call(null)}))}},{key:"onLoadGameClick",value:function(t){t.preventDefault(),this.loadGameListeners.forEach((function(t){return t.call(null)}))}},{key:"selectCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected","selected-".concat(e))}},{key:"deselectCell",value:function(t){var r,n=this.cells[t];(r=n.classList).remove.apply(r,e(Array.from(n.classList).filter((function(t){return t.startsWith("selected")}))))}},{key:"showCellTooltip",value:function(t,e){this.cells[e].title=t}},{key:"hideCellTooltip",value:function(t){this.cells[t].title=""}},{key:"showDamage",value:function(t,e){var r=this;return new Promise((function(n){var a=r.cells[t],i=document.createElement("span");i.textContent=e,i.classList.add("damage"),a.appendChild(i),i.addEventListener("animationend",(function(){a.removeChild(i),n()}))}))}},{key:"setCursor",value:function(t){this.boardEl.style.cursor=t}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}},{key:"closePopup",value:function(){this.popup.classList.add("popup_hidden")}},{key:"showPopup",value:function(t){this.popup.querySelector(".popup__title").textContent=t,this.popup.classList.remove("popup_hidden")}}],[{key:"showError",value:function(t){alert(t)}},{key:"showMessage",value:function(t){alert(t)}}]),t}();function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function u(t,e,r,n,a,i,o){try{var c=t[i](o),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,a)}var h,f={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"},d="auto",p="pointer",v="crosshair",y="not-allowed",m="computer",g="user",w=function(){function t(e,n,a,i){r(this,t),this.stage=e,this.teams=n,this.motion=a,this.scores=i||0,this.availableSteps=null,this.availableAttack=null,this.selectedHero=null}return a(t,[{key:"clear",value:function(){this.availableSteps=null,this.availableAttack=null,this.selectedHero=null}},{key:"removeHero",value:function(t){this.teams=this.teams.filter((function(e){return e.position!==t}))}},{key:"addScores",value:function(){var t=this.teams.reduce((function(t,e){return"user"===e.character.player?t+e.character.health:t}),0);this.scores+=t}}],[{key:"from",value:function(e){return new t(e.stage,e.teams,e.motion,e.scores)}}]),t}(),b=a((function t(e,n,a,i,o,c){if(r(this,t),this.level=e,this.attack=n,this.defence=a,this.health=100,this.player=i,this.stepsRadius=o,this.attackRadius=c,"Character"===(this instanceof t?this.constructor:void 0).name)throw new Error("Запрещено создавать объекты базового класса Character!")})),k=a((function t(e,n){if(r(this,t),!(e instanceof b))throw new Error("character must be instance of Character or its children");if("number"!=typeof n)throw new Error("position must be a number");this.character=e,this.position=n}));function S(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function L(t,e){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},L(t,e)}function P(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}function C(t,e){if(e&&("object"===l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return S(t)}function E(t){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},E(t)}function R(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function O(t,e,r,n){return O="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,r,n){var a,i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=E(t)););return t}(t,e);if(i){if((a=Object.getOwnPropertyDescriptor(i,e)).set)return a.set.call(n,r),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(n,e)){if(!a.writable)return!1;a.value=r,Object.defineProperty(n,e,a)}else R(n,e,r);return!0},O(t,e,r,n)}function G(t,e,r,n,a){if(!O(t,e,r,n||t)&&a)throw new Error("failed to set property");return r}var x=(R(h={},g,{Bowman:{attack:25,defence:25,stepsRadius:2,attackRadius:2},Magician:{attack:10,defence:40,stepsRadius:1,attackRadius:4},Swordsman:{attack:40,defence:10,stepsRadius:4,attackRadius:1}}),R(h,m,{Daemon:{attack:10,defence:40,stepsRadius:1,attackRadius:4},Undead:{attack:40,defence:10,stepsRadius:4,attackRadius:1},Vampire:{attack:25,defence:25,stepsRadius:2,attackRadius:2}}),h);var j=function(t){P(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=E(e);if(n){var a=E(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return C(this,t)});function o(t){var e,n;r(this,o);var a=x[g].Bowman,c=a.attack,s=a.defence,l=a.stepsRadius,u=a.attackRadius,h=g;return G((e=S(n=i.call(this,t,c,s,h,l,u)),E(o.prototype)),"type","bowman",e,!0),n}return a(o)}(b);var M=function(t){P(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=E(e);if(n){var a=E(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return C(this,t)});function o(t){var e,n;r(this,o);var a=x[m].Daemon,c=a.attack,s=a.defence,l=a.stepsRadius,u=a.attackRadius,h=m;return G((e=S(n=i.call(this,t,c,s,h,l,u)),E(o.prototype)),"type","daemon",e,!0),n}return a(o)}(b);var A=function(t){P(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=E(e);if(n){var a=E(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return C(this,t)});function o(t){var e,n;r(this,o);var a=x[g].Magician,c=a.attack,s=a.defence,l=a.stepsRadius,u=a.attackRadius,h=g;return G((e=S(n=i.call(this,t,c,s,h,l,u)),E(o.prototype)),"type","magician",e,!0),n}return a(o)}(b);var T=function(t){P(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=E(e);if(n){var a=E(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return C(this,t)});function o(t){var e,n;r(this,o);var a=x[g].Swordsman,c=a.attack,s=a.defence,l=a.stepsRadius,u=a.attackRadius,h=g;return G((e=S(n=i.call(this,t,c,s,h,l,u)),E(o.prototype)),"type","swordsman",e,!0),n}return a(o)}(b);var _=function(t){P(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=E(e);if(n){var a=E(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return C(this,t)});function o(t){var e,n;r(this,o);var a=x[m].Undead,c=a.attack,s=a.defence,l=a.stepsRadius,u=a.attackRadius,h=m;return G((e=S(n=i.call(this,t,c,s,h,l,u)),E(o.prototype)),"type","undead",e,!0),n}return a(o)}(b);var H=function(t){P(o,t);var e,n,i=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=E(e);if(n){var a=E(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return C(this,t)});function o(t){var e,n;r(this,o);var a=x[m].Vampire,c=a.attack,s=a.defence,l=a.stepsRadius,u=a.attackRadius,h=m;return G((e=S(n=i.call(this,t,c,s,h,l,u)),E(o.prototype)),"type","vampire",e,!0),n}return a(o)}(b),B=function(){function t(){r(this,t),this.members=new Set}return a(t,[{key:"add",value:function(t){this.members.add(t)}},{key:"toArray",get:function(){return e(this.members)}}]),t}();function I(t,e){var r=Math.floor(Math.random()*t.length),n=Math.floor(Math.random()*e)+1;return new t[r](n)}function D(t,e){for(var r=Math.pow(8,2)-1,n=[],a=t===g?0:6;a<=r;a+=8)n.push(a,a+1);var i=Math.floor(Math.random()*n.length);return e.some((function(t){return t==n[i]}))?D(t,e):(e.push(n[i]),n[i])}function N(t,r){for(var n=new Set,a=t,i=t,o=t,c=t;a>t-8*r&&a-8>=0;)a-=8;for(;i<t+8*r&&i+8<64;)i+=8;for(;o>t-r&&o%8!=0;)o-=1;for(;c<t+r&&(c+1)%8!=0;)c+=1;for(var s=o;s<=c;s+=1)n.add(s);for(var l=a;l<=i;l+=8)n.add(l);for(var u=t;u>=t-9*r&&(n.add(u),!(u%8==0||u-8<0));u-=9);for(var h=t;h<=t+9*r&&(n.add(h),!((h+1)%8==0||h+8>64));h+=9);for(var f=t;f>=t-7*r&&(n.add(f),!((f+1)%8==0||f-7<0));f-=7);for(var d=t;d<=t+7*r&&(n.add(d),!(d%8==0||d+7>=64));d+=7);return e(n).filter((function(e){return e!==t}))}function U(t,r){for(var n=new Set,a=t,i=t,o=null;a>t-r&&a%8!=0;)a-=1;for(;i<t+r&&(i+1)%8!=0;)i+=1;for(o=a;o<=i;){var c=o,s=o;for(n.add(o);c>o-8*r&&c-8>=0;)c-=8,n.add(c);for(;s<o+8*r&&s+8<64;)s+=8,n.add(s);o+=1}return e(n)}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function F(){F=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var a=e&&e.prototype instanceof f?e:f,i=Object.create(a.prototype),o=new P(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(a,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw i;return{value:void 0,done:!0}}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var c=k(o,r);if(c){if(c===h)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=u(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,o),i}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var h={};function f(){}function d(){}function p(){}var v={};c(v,a,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(C([])));m&&m!==e&&r.call(m,a)&&(v=m);var g=p.prototype=f.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(a,i,o,c){var s=u(t[a],t,i);if("throw"!==s.type){var h=s.arg,f=h.value;return f&&"object"==l(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,o,c)}),(function(t){n("throw",t,o,c)})):e.resolve(f).then((function(t){h.value=t,o(h)}),(function(t){return n("throw",t,o,c)}))}c(s.arg)}var a;this._invoke=function(t,r){function i(){return new e((function(e,a){n(t,r,e,a)}))}return a=a?a.then(i,i):i()}}function k(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,h;var a=n.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function C(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return d.prototype=p,c(g,"constructor",p),c(p,"constructor",d),d.displayName=c(p,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,o,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},w(b.prototype),c(b.prototype,i,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,a,i){void 0===i&&(i=Promise);var o=new b(s(e,r,n,a),i);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},w(g),c(g,o,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=C,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(L),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;L(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}var z=[T,j,A],$=[M,_,H],J=function(){function t(e,n){r(this,t),this.gamePlay=e,this.stateService=n,this.gameState=null}var n,i;return a(t,[{key:"init",value:function(){this.loadGame()}},{key:"checkCell",value:function(){this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addSaveGameListener(this.saveGame.bind(this)),this.gamePlay.addLoadGameListener(this.loadGame.bind(this)),this.gamePlay.addNewGameListener(this.newGame.bind(this))}},{key:"onCellClick",value:function(t){var e=this.gameState.teams.find((function(e){return e.position===t}));if(e&&e.character.player===g)return this.gameState.selectedHero&&this.gamePlay.deselectCell(this.gameState.selectedHero.position),this.gamePlay.selectCell(t),this.gameState.availableSteps=N(t,e.character.stepsRadius),this.gameState.availableAttack=U(t,e.character.attackRadius),void(this.gameState.selectedHero=e);if(this.gameState.selectedHero)return this.gameState.availableSteps.includes(t)&&!e&&(this.gamePlay.deselectCell(this.gameState.selectedHero.position),this.gameState.selectedHero.position=t,this.gamePlay.deselectCell(t),this.checkLevel()),e&&e.character.player===m&&this.gameState.availableAttack.includes(t)&&this.attack(e,this.gameState.selectedHero,t),void(e&&e.character.player===m&&!this.gameState.availableAttack.includes(t)&&this.gamePlay.showPopup("Нужно подойти ближе"));if(!this.gameState.selectedHero&&e&&e.character.player===m){var r=e.character.type;r=r[0].toUpperCase()+r.slice(1),this.gamePlay.showPopup("Это ".concat(r,"! Он явно не из наших!"))}}},{key:"onCellLeave",value:function(t){this.gamePlay.hideCellTooltip(t),this.gameState.selectedHero&&this.gameState.selectedHero.position!==t&&this.gamePlay.deselectCell(t)}},{key:"onCellEnter",value:function(t){var e=this.gameState.teams.find((function(e){return e.position===t}));if(e){var r=this.constructor.createToolTipTemplate.call(this,e);this.gamePlay.showCellTooltip(r,t)}this.activeCursor(e),this.gameState.selectedHero&&this.activeCursorSelectedHero(t,e)}},{key:"activeCursor",value:function(t){if(t){var e=t.character.player===g?p:y;this.gamePlay.setCursor(e)}else this.gamePlay.setCursor(d)}},{key:"activeCursorSelectedHero",value:function(t,e){this.gameState.availableSteps.includes(t)&&!e?(this.gamePlay.setCursor(p),this.gamePlay.selectCell(t,"green")):e&&e.character.player===m&&this.gameState.availableAttack.includes(t)?(this.gamePlay.setCursor(v),this.gamePlay.selectCell(t,"red")):e&&e.character.player===g?this.gamePlay.setCursor(p):this.gamePlay.setCursor(y)}},{key:"saveGame",value:function(){this.stateService.save(this.gameState),this.gamePlay.showPopup("Игра сохранена")}},{key:"loadGame",value:function(){0===this.gamePlay.cellClickListeners.length&&this.checkCell();try{var t=this.stateService.load();t?(this.gameState=w.from(t),this.gamePlay.drawUi(Object.values(f)[this.gameState.stage-1]),this.gamePlay.redrawPositions(this.gameState.teams)):this.newGame()}catch(t){this.constructor.clearLocalStorage("state"),this.gamePlay.showPopup('Ошибка загрузки: "'.concat(t.message,'"')),this.newGame()}}},{key:"newGame",value:function(){0===this.gamePlay.cellClickListeners.length&&this.gamePlay.addCellClickListener(this.onCellClick.bind(this));var t=this.gameState?this.gameState.scores:0;this.gameState=new w(1,[],g,t),this.nextStage(this.gameState.stage)}},{key:"nextPlayer",value:function(){this.gameState.motion=this.gameState.motion===g?m:g,this.gameState.motion===m&&this.computerLogic(),this.gameState.clear()}},{key:"checkLevel",value:function(){var t=this.gameState.teams.some((function(t){return t.character.player===g})),e=this.gameState.teams.some((function(t){return t.character.player===m}));t&&e?this.nextPlayer():(e||(this.gameState.clear(),this.gameState.addScores(),this.nextStage(this.gameState.stage+=1)),t||this.gamePlay.showPopup("Вы проиграли! Попробуйте еще раз!"))}},{key:"nextStage",value:function(t){if(1===t&&(this.constructor.teamGeneration.call(this,z,g,1,2),this.constructor.teamGeneration.call(this,$,m,1,2)),t>1&&t<5){this.constructor.levelUp.call(this);var e=2===t?1:2;this.constructor.teamGeneration.call(this,z,g,t-1,e);var r=this.gameState.teams.filter((function(t){return t.character.player===g})).length;this.constructor.teamGeneration.call(this,$,m,t,r),this.gamePlay.showPopup("Уровень ".concat(t," Счет: ").concat(this.gameState.scores))}t>=5?(this.gamePlay.cellClickListeners.length=0,this.gamePlay.showPopup("Победа! Игра окончена. Счет: ".concat(this.gameState.scores))):(this.gamePlay.drawUi(Object.values(f)[this.gameState.stage-1]),this.gamePlay.redrawPositions(this.gameState.teams))}},{key:"attack",value:(n=F().mark((function t(e,r,n){var a,i,o;return F().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.character.attack,e.character.defense,i=e.character,o=2*Math.round(Math.max(.1*a)),i.health-=o,e.character.health<=0&&this.gameState.removeHero(n),this.gamePlay.selectCell(r.position),this.gamePlay.selectCell(e.position,"red"),this.gamePlay.redrawPositions(this.gameState.teams),this.gameState.selectedHero=null,t.next=12,this.gamePlay.showDamage(n,o);case 12:this.gamePlay.deselectCell(r.position),this.gamePlay.deselectCell(e.position),this.checkLevel();case 15:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,a){var i=n.apply(t,e);function o(t){u(i,r,a,o,c,"next",t)}function c(t){u(i,r,a,o,c,"throw",t)}o(void 0)}))},function(t,e,r){return i.apply(this,arguments)})},{key:"computerLogic",value:function(){var t=this,e=this.gameState.teams,r=e.filter((function(t){return t.character.player===m})),n=e.filter((function(t){return t.character.player===g}));if(e.map((function(t){return t.position})),!r.some((function(e){t.gameState.availableAttack=U(e.position,e.character.attackRadius);var r=n.find((function(e){return t.gameState.availableAttack.includes(e.position)}));return!!r&&(t.attack(r,e,r.position),!0)}))&&r.length&&n.length){var a=Math.floor(Math.random()*r.length),i=N(r[a].position,r[a].character.stepsRadius).filter((function(t){return e.map((function(t){return t.position})).indexOf(t)<0})),o=Math.floor(Math.random()*i.length);r[a].position=i[o],this.checkLevel(),this.gamePlay.redrawPositions(this.gameState.teams)}}}],[{key:"createToolTipTemplate",value:function(t){var e=t.character,r=e.level,n=e.health,a=e.attack,i=e.defence;return"🎖 ".concat(r," ⚔ ").concat(a," 🛡 ").concat(i," ❤ ").concat(n)}},{key:"levelUp",value:function(){var t,e=[],r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return q(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){c=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}(this.gameState.teams);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=n.character;n.position=D(g,e),a.level+=1,a.health=a.health+80>=100?100:a.health+80,a.attack=Math.floor(Math.max(a.attack,a.attack*(.8+a.health/100)))}}catch(t){r.e(t)}finally{r.f()}e=[]}},{key:"teamGeneration",value:function(t,r,n,a){var i,o=function(t,e,r){for(var n=new B,a=0;a<r;a+=1)n.add(I(t,e));return n}(t,n,a),c=[];this.gameState.teams.length&&this.gameState.teams.forEach((function(t){return c.push(t.position)}));var s=[];o=o.toArray.reduce((function(t,e){var n=D(r,s);return c.push(n),t.push(new k(e,n)),t}),[]),s=[],(i=this.gameState.teams).push.apply(i,e(o))}},{key:"clearLocalStorage",value:function(t){localStorage.removeItem(t)}}]),t}(),V=function(){function t(e){r(this,t),this.storage=e}return a(t,[{key:"save",value:function(t){this.storage.setItem("state",JSON.stringify(t))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(t){throw new Error("Invalid state")}}}]),t}(),Y=new s;Y.bindToDOM(document.querySelector("#game-container")),Y.bindPopup(document.querySelector("#popup")),new J(Y,new V(localStorage)).init()}();
//# sourceMappingURL=app.c18fa613983fecddd2c9.js.map